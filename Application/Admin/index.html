CREATE TABLE `jry_think_admin_dpdy`.`dpdy_log_info`(  
  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(200) COMMENT '后台自定义的名称',
  `value` VARCHAR(200) COMMENT '客户发送的一些基本信息',
  `type` INT UNSIGNED DEFAULT 1 COMMENT '分类。0顶级直属分类，其他值为该值对应的ID',
  `ad_time` INT UNSIGNED COMMENT '添加时间',
  `status` TINYINT UNSIGNED DEFAULT 99 COMMENT '状态，99正常98删除',
  `del_time` INT UNSIGNED COMMENT '删除时间',
  PRIMARY KEY (`id`)
) ENGINE=MyISAM AUTO_INCREMENT=1 DEFAULT CHARSET=utf8 COMMENT='日志详情表，保存日志的附加信息';


INSERT INTO 
    `dpdy_log_info`(`id`,`name`,`value`,`type`,`ad_time`,`status`,`del_time`) 
VALUES 
    (1,'浏览器','浏览器',0,UNIX_TIMESTAMP(),99,0),
    (2,'操作系统','操作系统',0,UNIX_TIMESTAMP(),99,0),
    (3,'浏览器抬头','浏览器抬头',0,UNIX_TIMESTAMP(),99,0),
    (4,'用户IP地址','用户IP地址',0,UNIX_TIMESTAMP(),99,0),
    (5,'用户IP对应城市','用户IP对应城市',0,UNIX_TIMESTAMP(),99,0),
    (6,'IPv6地址','IPv6地址',0,UNIX_TIMESTAMP(),99,0),
    (7,'未分类','未分类',0,UNIX_TIMESTAMP(),99,0);

INSERT INTO `dpdy_log_info` (`name`,`value`,`type`,`ad_time`,`status`,`del_time`) SELECT `browser`,`browser`,1,UNIX_TIMESTAMP(),99,0 FROM `dpdy_log` GROUP BY `browser` ;


INSERT INTO `dpdy_log_info` (`name`,`value`,`type`,`ad_time`,`status`,`del_time`) SELECT `system`,`system`,2,UNIX_TIMESTAMP(),99,0 FROM `dpdy_log` GROUP BY `system` ;


INSERT INTO `dpdy_log_info` (`name`,`value`,`type`,`ad_time`,`status`,`del_time`) SELECT `user_agent`,`user_agent`,3,UNIX_TIMESTAMP(),99,0 FROM `dpdy_log` GROUP BY `user_agent` ;


INSERT INTO `dpdy_log_info` (`name`,`value`,`type`,`ad_time`,`status`,`del_time`) SELECT `ad_ip`,`ad_ip`,4,UNIX_TIMESTAMP(),99,0 FROM `dpdy_log` GROUP BY `ad_ip` ;


INSERT INTO `dpdy_log_info` (`name`,`value`,`type`,`ad_time`,`status`,`del_time`) SELECT `ip_city`,`ip_city`,5,UNIX_TIMESTAMP(),99,0 FROM `dpdy_log` GROUP BY `ip_city` ;


UPDATE `dpdy_log` AS `k1`,(SELECT `id`,`name`,`value` FROM `dpdy_log_info` WHERE `type` <> 0 AND `status` <> 98) AS `k2` SET `k1`.`browser` = `k2`.`id` WHERE `k1`.`browser` = `k2`.`value`;


UPDATE `dpdy_log` AS `k1`,(SELECT `id`,`name`,`value` FROM `dpdy_log_info` WHERE `type` <> 0 AND `status` <> 98) AS `k2` SET `k1`.`system` = `k2`.`id` WHERE `k1`.`system` = `k2`.`value`;


UPDATE `dpdy_log` AS `k1`,(SELECT `id`,`name`,`value` FROM `dpdy_log_info` WHERE `type` <> 0 AND `status` <> 98) AS `k2` SET `k1`.`user_agent` = `k2`.`id` WHERE `k1`.`user_agent` = `k2`.`value`;


UPDATE `dpdy_log` AS `k1`,(SELECT `id`,`name`,`value` FROM `dpdy_log_info` WHERE `type` <> 0 AND `status` <> 98) AS `k2` SET `k1`.`ad_ip` = `k2`.`id` WHERE `k1`.`ad_ip` = `k2`.`value`;


UPDATE `dpdy_log` AS `k1`,(SELECT `id`,`name`,`value` FROM `dpdy_log_info` WHERE `type` <> 0 AND `status` <> 98) AS `k2` SET `k1`.`ip_city` = `k2`.`id` WHERE `k1`.`ip_city` = `k2`.`value`;


ALTER TABLE `jry_think_admin_dpdy`.`dpdy_log`   
  CHANGE `browser` `browser` INT UNSIGNED NULL  COMMENT '操作人浏览器类型,用英文半角逗号间隔浏览器和版本',
  CHANGE `system` `system` INT UNSIGNED NULL  COMMENT '操作人系统类型，用英文半角逗号间隔系统名称和版本号',
  CHANGE `user_agent` `user_agent` INT UNSIGNED NULL  COMMENT '用户操作时发送过来的User-Agent请求头',
  CHANGE `ad_ip` `ad_ip` INT UNSIGNED NULL  COMMENT '操作人电脑IP',
  CHANGE `ip_city` `ip_city` INT UNSIGNED NULL  COMMENT '根据操作用户IP地址判断出来的位置';

  
  
UPDATE `dpdy_user_log` AS `k1`,(SELECT `id`,`name`,`value` FROM `dpdy_log_info` WHERE `type` <> 0 AND `status` <> 98) AS `k2` SET `k1`.`ad_ip` = `k2`.`id` WHERE `k1`.`ad_ip` = `k2`.`value`;


UPDATE `dpdy_user_log` AS `k1`,(SELECT `id`,`name`,`value` FROM `dpdy_log_info` WHERE `type` <> 0 AND `status` <> 98) AS `k2` SET `k1`.`browser` = `k2`.`id` WHERE `k1`.`browser` = `k2`.`value`;


UPDATE `dpdy_user_log` AS `k1`,(SELECT `id`,`name`,`value` FROM `dpdy_log_info` WHERE `type` <> 0 AND `status` <> 98) AS `k2` SET `k1`.`system` = `k2`.`id` WHERE `k1`.`system` = `k2`.`value`;


UPDATE `dpdy_user_log` AS `k1`,(SELECT `id`,`name`,`value` FROM `dpdy_log_info` WHERE `type` <> 0 AND `status` <> 98) AS `k2` SET `k1`.`user_agent` = `k2`.`id` WHERE `k1`.`user_agent` = `k2`.`value`;


UPDATE `dpdy_user_log` AS `k1`,(SELECT `id`,`name`,`value` FROM `dpdy_log_info` WHERE `type` <> 0 AND `status` <> 98) AS `k2` SET `k1`.`ip_city` = `k2`.`id` WHERE `k1`.`ip_city` = `k2`.`value`;


INSERT INTO `dpdy_log_info` (`name`,`value`,`type`,`ad_time`,`status`,`del_time`) SELECT `system`,`system`,2,UNIX_TIMESTAMP(),99,0 FROM `dpdy_user_log` WHERE `system` REGEXP '[^a-w0-9]' GROUP BY `system` ;


INSERT INTO `dpdy_log_info` (`name`,`value`,`type`,`ad_time`,`status`,`del_time`) SELECT `browser`,`browser`,1,UNIX_TIMESTAMP(),99,0 FROM `dpdy_user_log` WHERE `browser` REGEXP '[^a-w0-9]' GROUP BY `browser` ;


INSERT INTO `dpdy_log_info` (`name`,`value`,`type`,`ad_time`,`status`,`del_time`) SELECT `user_agent`,`user_agent`,3,UNIX_TIMESTAMP(),99,0 FROM `dpdy_user_log` WHERE `user_agent` REGEXP '[^a-w0-9]' GROUP BY `user_agent` ;


INSERT INTO `dpdy_log_info` (`name`,`value`,`type`,`ad_time`,`status`,`del_time`) SELECT `ad_ip`,`ad_ip`,4,UNIX_TIMESTAMP(),99,0 FROM `dpdy_user_log` WHERE `ad_ip` REGEXP '[^a-w0-9]' GROUP BY `ad_ip` ;


INSERT INTO `dpdy_log_info` (`name`,`value`,`type`,`ad_time`,`status`,`del_time`) SELECT `ip_city`,`ip_city`,5,UNIX_TIMESTAMP(),99,0 FROM `dpdy_user_log` WHERE `ip_city` REGEXP '[^a-w0-9]' GROUP BY `ip_city` ;


UPDATE `dpdy_user_log` AS `k1`,(SELECT `id`,`name`,`value` FROM `dpdy_log_info` WHERE `type` <> 0 AND `status` <> 98) AS `k2` SET `k1`.`ad_ip` = `k2`.`id` WHERE `k1`.`ad_ip` = `k2`.`value`;


UPDATE `dpdy_user_log` AS `k1`,(SELECT `id`,`name`,`value` FROM `dpdy_log_info` WHERE `type` <> 0 AND `status` <> 98) AS `k2` SET `k1`.`browser` = `k2`.`id` WHERE `k1`.`browser` = `k2`.`value`;


UPDATE `dpdy_user_log` AS `k1`,(SELECT `id`,`name`,`value` FROM `dpdy_log_info` WHERE `type` <> 0 AND `status` <> 98) AS `k2` SET `k1`.`system` = `k2`.`id` WHERE `k1`.`system` = `k2`.`value`;


UPDATE `dpdy_user_log` AS `k1`,(SELECT `id`,`name`,`value` FROM `dpdy_log_info` WHERE `type` <> 0 AND `status` <> 98) AS `k2` SET `k1`.`user_agent` = `k2`.`id` WHERE `k1`.`user_agent` = `k2`.`value`;


UPDATE `dpdy_user_log` AS `k1`,(SELECT `id`,`name`,`value` FROM `dpdy_log_info` WHERE `type` <> 0 AND `status` <> 98) AS `k2` SET `k1`.`ip_city` = `k2`.`id` WHERE `k1`.`ip_city` = `k2`.`value`;


ALTER TABLE `jry_think_admin_dpdy`.`dpdy_user_log`   
  CHANGE `ad_ip` `ad_ip` INT UNSIGNED NULL  COMMENT '操作人电脑IP',
  CHANGE `browser` `browser` INT UNSIGNED NULL  COMMENT '操作人浏览器类型,用英文半角逗号间隔浏览器和版本',
  CHANGE `system` `system` INT UNSIGNED NULL  COMMENT '操作人系统类型，用英文半角逗号间隔系统名称和版本号',
  CHANGE `user_agent` `user_agent` INT UNSIGNED NULL  COMMENT '用户操作时发送过来的User-Agent请求头',
  CHANGE `ip_city` `ip_city` INT UNSIGNED NULL  COMMENT '根据操作用户IP地址判断出来的位置';

  
  
  